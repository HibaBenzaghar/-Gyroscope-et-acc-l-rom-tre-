#include <Wire.h>
#include <LiquidCrystal_I2C.h>
#include <Adafruit_MPU6050.h>
#include <Adafruit_Sensor.h>

Adafruit_MPU6050 mpu;
LiquidCrystal_I2C lcd(0x27, 16, 2);

void setup() {
  Serial.begin(115200);
  Wire.begin();

  if (!mpu.begin()) {
    Serial.println("Failed to find MPU6050 chip");
    while (1);
  }

  mpu.setAccelerometerRange(MPU6050_RANGE_8_G);
  mpu.setGyroRange(MPU6050_RANGE_500_DEG);
  mpu.setFilterBandwidth(MPU6050_BAND_21_HZ);

  lcd.init();
  lcd.backlight();
}

void loop() {
  sensors_event_t a, g, temp;
  mpu.getEvent(&a, &g, &temp);

  // Read accelerometer data
  float ax = a.acceleration.x;
  float ay = a.acceleration.y;
  float az = a.acceleration.z;

  // Compute pitch and roll (in degrees)
  float pitch = atan2(ax, sqrt(ay * ay + az * az)) * 180.0 / PI;
  float roll  = atan2(ay, sqrt(ax * ax + az * az)) * 180.0 / PI;

  lcd.clear();
  lcd.setCursor(0, 0);

  // Detect movement based on orientation
  if (roll > 30) {
    lcd.print("Mvt: Droite →");
  } else if (roll < -30) {
    lcd.print("Mvt: Gauche ←");
  } else if (pitch > 30) {
    lcd.print("Mvt: Avant ↑");
  } else if (pitch < -30) {
    lcd.print("Mvt: Arriere ↓");
  } else {
    lcd.print("Stable");
  }

  lcd.setCursor(0, 1);
  lcd.print("Roll:");
  lcd.print(roll, 1);
  lcd.print(" P:");
  lcd.print(pitch, 1);

  delay(500);
}
